// Generated by CoffeeScript 1.8.0
(function() {
  var RSVP, fs, _;

  RSVP = require('rsvp');

  fs = require('fs');

  _ = require('underscore');

  module.exports = function(data) {
    return new RSVP.Promise(function(resolve) {
      var linkedMedia, localMedia, urls;
      linkedMedia = '';
      localMedia = '';
      urls = '';
      data.docdirname = "" + data.dirname + "/docs";
      fs.mkdirSync(data.docdirname);
      _(data.prs).each(function(pr) {
        return _(pr.urls).each(function(mediaUrl) {
          if (mediaUrl.match(/.mov$/)) {
            linkedMedia += "<embed src='" + mediaUrl + "' width='800' height='450'></embed>\n";
          } else {
            linkedMedia += "<img src='" + mediaUrl + "'>\n";
          }
          return urls += "" + mediaUrl + "\n";
        });
      });
      _(data.prs).each(function(pr) {
        return _(pr.urls).each(function(mediaUrl) {
          var filename, match;
          match = mediaUrl.match(/([^/])+/g);
          filename = match[match.length - 1];
          if (filename.match(/.mov$/)) {
            return localMedia += "<embed src='../" + filename + "' width='800' height='450'></embed>\n";
          } else {
            return localMedia += "<img src='../" + filename + "'>\n";
          }
        });
      });
      fs.writeFile("" + data.docdirname + "/linked-media.html", linkedMedia);
      fs.writeFile("" + data.docdirname + "/local-media.html", localMedia);
      fs.writeFile("" + data.docdirname + "/urls.txt", urls);
      return resolve(data);
    });
  };

}).call(this);
